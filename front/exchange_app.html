<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>汇率转换器 + 登录注册</title>
<style>
    body { font-family: Arial; padding: 20px; }
    input, button { margin: 8px 0; padding: 8px; width: 260px; }
    .card {
        border: 1px solid #ccc;
        padding: 15px;
        width: 300px;
        margin-top: 20px;
        border-radius: 6px;
    }
    #exchangeCard { display: none; }
</style>
</head>
<body>

<h2>汇率转换平台</h2>

<!-- 注册 -->
<div id="registerCard" class="card">
    <h3>注册</h3>
    <input id="regUsername" placeholder="用户名">
    <input id="regPassword" placeholder="密码" type="password">
    <button onclick="register()">注册</button>
    <div id="regResult" style="margin-top:10px; color:red;"></div>
</div>

<!-- 登录 -->
<div id="loginCard" class="card">
    <h3>登录</h3>
    <input id="loginUsername" placeholder="用户名">
    <input id="loginPassword" placeholder="密码" type="password">
    <button onclick="login()">登录</button>
    <div id="loginResult" style="margin-top:10px; color:red;"></div>
</div>

<!-- 汇率转换 -->
<div id="exchangeCard" class="card">
    <h3>汇率转换工具</h3>
    <input id="fromCurrency" placeholder="来源货币，例如 USD">
    <input id="toCurrency" placeholder="目标货币，例如 CNY">
    <input id="amount" placeholder="金额，例如 100" type="number">
    <button onclick="convert()">转换</button>
    <div id="result" style="margin-top:10px; font-weight:bold;"></div>
</div>

<script>
const API = "http://localhost:8080/api";
const USER = "http://localhost:8080/user";

// 注册
async function register() {
    const username = document.getElementById("regUsername").value.trim();
    const password = document.getElementById("regPassword").value;

    if (!username || !password) {
        document.getElementById("regResult").innerText = "请输入用户名和密码！";
        return;
    }

    const res = await fetch(`${USER}/register`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({username, password})
    });

    const data = await res.json();
    if (res.status === 201) {
        document.getElementById("regResult").style.color = "green";
        document.getElementById("regResult").innerText = "注册成功！请登录";
    } else {
        document.getElementById("regResult").style.color = "red";
        document.getElementById("regResult").innerText = data.error || "注册失败";
    }
}

// 登录
async function login() {
    const username = document.getElementById("loginUsername").value.trim();
    const password = document.getElementById("loginPassword").value;

    if (!username || !password) {
        document.getElementById("loginResult").innerText = "请输入用户名和密码！";
        return;
    }

    const res = await fetch(`${USER}/login`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({username, password})
    });

    const data = await res.json();

    if (res.status === 200) {
        document.getElementById("loginResult").style.color = "green";
        document.getElementById("loginResult").innerText = "登录成功！";
        document.getElementById("loginCard").style.display = "none";
        document.getElementById("registerCard").style.display = "none";
        document.getElementById("exchangeCard").style.display = "block";
    } else {
        document.getElementById("loginResult").style.color = "red";
        document.getElementById("loginResult").innerText = data.error || "登录失败";
    }
}

// 汇率转换
async function convert() {
    const from = document.getElementById("fromCurrency").value.trim().toUpperCase();
    const to = document.getElementById("toCurrency").value.trim().toUpperCase();
    const amount = parseFloat(document.getElementById("amount").value);

    if (!from || !to || isNaN(amount)) {
        document.getElementById("result").innerText = "请输入完整信息！";
        return;
    }

    const res = await fetch(`${API}/exchangeRates?from=${from}&to=${to}`);
    const data = await res.json();

    if (!data.rate) {
        document.getElementById("result").innerText = "未找到汇率，请先添加";
        return;
    }

    const result = amount * data.rate;

    document.getElementById("result").innerHTML =
        `使用汇率：${data.from_currency} → ${data.to_currency} = ${data.rate}<br>
         ${amount} ${data.from_currency} ≈ ${result.toFixed(2)} ${data.to_currency}`;
}
</script>
</body>
</html>
